<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Login - Open IP-KVM</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div id="login" style="max-width: 350px; margin: 100px auto;">
      <h2>Login</h2>
      <form id="loginForm">
        <input name="username" placeholder="Username" required style="width:100%;margin-bottom:10px;" />
        <input name="password" type="password" placeholder="Password" required style="width:100%;margin-bottom:10px;" />
        <button type="submit" style="width:100%;">Login</button>
      </form>
      <div id="loginError" style="color:red;"></div>
    </div>
    <script>
      document.getElementById('loginForm').onsubmit = async function(e) {
        e.preventDefault();
        const form = e.target;
        const username = form.username.value;
        const password = form.password.value;
        const res = await fetch('/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
        });
        if (res.ok) {
          const data = await res.json();
          localStorage.setItem('token', data.token);
          window.location.href = '/';
        } else {
          document.getElementById('loginError').innerText = 'Login failed';
        }
      };
    </script>
  </body>
</html>